import{m as g,A as c,_ as D,r as A,u as x,n as S,b as u,P as l,l as v,t as T,j as b,c as a,a as n,f as w,q as y,F as C,g as I,s as B,v as E,x as L,o as r,p as j,k as P}from"./index-b6c2dc97.js";class p{constructor(o){this.id=o.id,this.creatorId=o.creatorId,this.eventId=o.eventId,this.body=o.body,this.isAttending=o.isAttending,this.createdAt=new Date(o.createdAt),this.updatedAt=new Date(o.updatedAt),this.creator=o.creator}}class F{async getCommentsByTowerId(o){const m=await g.get(`api/events/${o}/comments`);c.comments=m.data.map(e=>new p(e))}async createComment(o){const m=await g.post("api/comments",o),e=new p(m.data);c.comments.unshift(e)}async deleteComment(o){await g.delete(`api/comments/${o}`),c.comments=c.comments.filter(m=>m.id!==o)}}const f=new F;const R={setup(){const d=A({}),o=x();async function m(){try{const t=o.params.eventId;await b.getTowerById(t)}catch(t){l.error(t.message),v.log(t)}}async function e(){try{const t=o.params.eventId;await T.getTicketsByTowerId(t)}catch(t){l.error(t.message),v.log(t)}}async function h(){try{const t=o.params.eventId;await f.getCommentsByTowerId(t)}catch(t){l.error(t.message),v.log(t)}}return S(()=>{m(),e(),h()}),{editable:d,towers:u(()=>c.towers),activeTower:u(()=>c.activeTower),tickets:u(()=>c.tickets),comments:u(()=>c.comments),ticketsLeft:u(()=>c.activeTower.capacity-c.activeTower.ticketCount),account:u(()=>c.account),isAttending:u(()=>c.tickets.find(t=>t.accountId==c.account.id)),async createComment(){try{const t=d.value;t.eventId=o.params.eventId,await f.createComment(t),d.value={}}catch(t){l.error(t.message),v.log(t)}},async deleteComment(){try{const i=c.comments.find(s=>s.creatorId==c.account.id).id;await f.deleteComment(i)}catch(t){l.error(t.message),v.log(t)}},async attendTower(){try{const t=o.params.eventId,i={};i.eventId=t,await T.attendTower(i),c.activeTower.ticketCount++}catch(t){l.error(t.message),v.log(t)}},async unAttendTower(){try{const i=c.tickets.find(k=>k.accountId==c.account.id).id;if(!await l.confirm("Are you sure you want to cancel your ticket to this event?"))return;await T.unAttendTower(i),c.activeTower.ticketCount--}catch(t){l.error(t.message),v.log(t)}},async archiveTower(){try{const t=o.params.eventId;if(!await l.confirm("Are you sure you want to cancel event?"))return;await b.archiveTower(t),m()}catch(t){l.error(t.message),v.log(t)}},formatDate(t){const i=new Date(t),s={dateStyle:"short",timeStyle:"short"};return i.toLocaleString(void 0,s)}}}},_=d=>(j("data-v-0e8b0791"),d=d(),P(),d),V={class:"container"},q={key:0,class:"row lighter-color mt-4 rounded"},M={class:"col-md-4 col-6"},N=["src"],U=["src"],G={class:"col-md-8 col-6"},H={key:0,class:"text-danger"},W={key:1,class:"fs-4 text-danger"},z={key:2},J={key:4,disabled:"",class:"btn btn-warning"},K=_(()=>n("span",{class:"pe-2"},"Event Hosted By: ",-1)),O=["src"],Q={class:"ps-2"},X={class:"text-end"},Y=_(()=>n("h5",{class:"mb-0"},"Who's Going",-1)),Z={class:"row secondary-color rounded"},$={class:"col-12 d-flex"},ee=["src","alt","title"],te={key:1,class:"row justify-content-center"},oe={class:"col-md-10 col-12"},ne=_(()=>n("label",{for:"comment"},"Comments",-1)),se=_(()=>n("div",{class:"d-flex justify-content-end"},[n("button",{class:"btn btn-primary",type:"submit"},"Post")],-1)),ce={class:"row danger-color rounded"},ae={class:"row"},re={class:"col-md-4 col-6 d-flex justify-content-end pt-2"},ie=["src"],de={class:"pt-2 ps-2"},le={class:"col-md-8 col-6 bg-light elevation-4 my-2 d-flex justify-content-between"};function me(d,o,m,e,h,t){var i;return r(),a("div",V,[e.activeTower?(r(),a("section",q,[n("div",M,[e.activeTower.isCanceled==!1?(r(),a("img",{key:0,class:"img-fluid rounded mt-2",src:e.activeTower.coverImg,alt:""},null,8,N)):(r(),a("img",{key:1,class:"img-fluid canceled-img rounded mt-2",src:e.activeTower.coverImg,alt:""},null,8,U)),n("div",null,"Created At: "+w(e.formatDate(e.activeTower.createdAt)),1)]),n("div",G,[e.activeTower.isCanceled==!0?(r(),a("h1",H,"Canceled")):y("",!0),n("h2",null,w(e.activeTower.name),1),n("p",null,w(e.activeTower.description),1),e.activeTower.isCanceled==!0?(r(),a("p",W,"Event is Canceled")):(r(),a("h4",z,"Spots Left: "+w(e.ticketsLeft),1)),!e.isAttending&&e.activeTower.isCanceled==!1&&e.activeTower.capacity-e.activeTower.ticketCount!=0?(r(),a("button",{key:3,onClick:o[0]||(o[0]=s=>e.attendTower()),class:"btn btn-warning"},"Attend")):y("",!0),e.activeTower.capacity-e.activeTower.ticketCount===0?(r(),a("button",J,"FULL")):y("",!0),e.isAttending&&e.activeTower.isCanceled==!1?(r(),a("button",{key:5,onClick:o[1]||(o[1]=s=>e.unAttendTower()),class:"btn btn-danger"},"Cancel")):y("",!0),n("div",null,"Event Time: "+w(e.formatDate(e.activeTower.startDate)),1),n("div",null,[K,n("img",{class:"ticket-img",src:e.activeTower.creator.picture,alt:""},null,8,O),n("span",Q,w(e.activeTower.creator.name),1),n("p",X,"Type of Event: "+w(e.activeTower.type),1)])]),e.account.id==e.activeTower.creatorId&&e.activeTower.isCanceled==!1?(r(),a("button",{key:0,onClick:o[2]||(o[2]=s=>e.archiveTower()),class:"btn btn-danger"}," Cancel Event")):y("",!0)])):y("",!0),Y,n("section",Z,[n("div",$,[(r(!0),a(C,null,I(e.tickets,s=>(r(),a("div",{key:s.id,class:"py-1"},[n("img",{class:"ticket-img",src:s.profile.picture,alt:s.profile.name,title:s.profile.name},null,8,ee)]))),128))])]),(i=e.activeTower)!=null&&i.isCanceled?y("",!0):(r(),a("section",te,[n("div",oe,[n("form",{onSubmit:o[4]||(o[4]=B(s=>e.createComment(),["prevent"]))},[ne,E(n("textarea",{required:"","onUpdate:modelValue":o[3]||(o[3]=s=>e.editable.body=s),class:"form-control",name:"comment",id:"comment",rows:"3"},null,512),[[L,e.editable.body]]),se],32)])])),n("section",ce,[(r(!0),a(C,null,I(e.comments,s=>(r(),a("div",{key:s.id,class:"col-md-10 col-12"},[n("section",ae,[n("div",re,[n("img",{class:"img-fluid ticket-img mt-2",src:s.creator.picture,alt:""},null,8,ie),n("h5",de,w(s.creator.name),1)]),n("div",le,[n("p",null,w(s.body),1),e.account.id==s.creatorId?(r(),a("button",{key:0,onClick:o[5]||(o[5]=k=>e.deleteComment()),class:"btn btn-danger"},"Delete")):y("",!0)])])]))),128))])])}const ve=D(R,[["render",me],["__scopeId","data-v-0e8b0791"]]);export{ve as default};
