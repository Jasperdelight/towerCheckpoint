import{m as g,A as c,_ as D,r as x,u as A,n as S,b as _,P as l,l as v,t as h,j as C,c as a,a as s,f as w,q as y,F as I,g as b,s as B,v as E,x as L,o as r,p as j,k as P}from"./index-bf547331.js";class p{constructor(o){this.id=o.id,this.creatorId=o.creatorId,this.eventId=o.eventId,this.body=o.body,this.isAttending=o.isAttending,this.createdAt=new Date(o.createdAt),this.updatedAt=new Date(o.updatedAt),this.creator=o.creator}}class F{async getCommentsByTowerId(o){const m=await g.get(`api/events/${o}/comments`);c.comments=m.data.map(e=>new p(e))}async createComment(o){const m=await g.post("api/comments",o),e=new p(m.data);c.comments.unshift(e)}async deleteComment(o){await g.delete(`api/comments/${o}`),c.comments=c.comments.filter(m=>m.id!==o)}}const T=new F;const R={setup(){const d=x({}),o=A();async function m(){try{const t=o.params.eventId;await C.getTowerById(t)}catch(t){l.error(t.message),v.log(t)}}async function e(){try{const t=o.params.eventId;await h.getTicketsByTowerId(t)}catch(t){l.error(t.message),v.log(t)}}async function f(){try{const t=o.params.eventId;await T.getCommentsByTowerId(t)}catch(t){l.error(t.message),v.log(t)}}return S(()=>{m(),e(),f()}),{editable:d,towers:_(()=>c.towers),activeTower:_(()=>c.activeTower),tickets:_(()=>c.tickets),comments:_(()=>c.comments),ticketsLeft:_(()=>c.activeTower.capacity-c.activeTower.ticketCount),account:_(()=>c.account),isAttending:_(()=>c.tickets.find(t=>t.accountId==c.account.id)),async createComment(){try{const t=d.value;t.eventId=o.params.eventId,await T.createComment(t),d.value={}}catch(t){l.error(t.message),v.log(t)}},async deleteComment(){try{const i=c.comments.find(n=>n.creatorId==c.account.id).id;await T.deleteComment(i)}catch(t){l.error(t.message),v.log(t)}},async attendTower(){try{const t=o.params.eventId,i={};i.eventId=t,await h.attendTower(i),c.activeTower.ticketCount++}catch(t){l.error(t.message),v.log(t)}},async unAttendTower(){try{const i=c.tickets.find(k=>k.accountId==c.account.id).id;if(!await l.confirm("Are you sure you want to cancel your ticket to this event?"))return;await h.unAttendTower(i),c.activeTower.ticketCount--}catch(t){l.error(t.message),v.log(t)}},async archiveTower(){try{const t=o.params.eventId;if(!await l.confirm("Are you sure you want to cancel event?"))return;await C.archiveTower(t),m()}catch(t){l.error(t.message),v.log(t)}},formatDate(t){const i=new Date(t),n={dateStyle:"short",timeStyle:"short"};return i.toLocaleString(void 0,n)}}}},u=d=>(j("data-v-325d1d84"),d=d(),P(),d),V={class:"container"},q={key:0,class:"row lighter-color mt-4 rounded"},M={class:"col-md-4 col-6"},N=["src"],U=["src"],G={class:"text-white"},H={class:"col-md-8 col-6 text-white"},W={key:0,class:"text-danger"},z={key:1,class:"fs-4 text-danger"},J={key:2},K={key:4,disabled:"",class:"btn btn-warning"},O=u(()=>s("span",{class:"pe-2"},"Event Hosted By: ",-1)),Q=["src"],X={class:"ps-2"},Y={class:"text-end"},Z=u(()=>s("h5",{class:"mb-0 text-white"},"Who's Going",-1)),$={class:"row main-color rounded"},ee={class:"col-12 d-flex"},te=["src","alt","title"],oe={key:1,class:"row justify-content-center"},se={class:"col-md-10 col-12"},ne=u(()=>s("label",{for:"comment",class:"text-white"},"Comments",-1)),ce=u(()=>s("div",{class:"d-flex justify-content-end"},[s("button",{class:"btn btn-primary",type:"submit"},"Post")],-1)),ae={class:"row danger-color rounded"},re={class:"row"},ie={class:"col-md-4 col-6 d-flex justify-content-end pt-2"},de=["src"],le={class:"pt-2 ps-2 text-white"},me={class:"col-md-8 col-6 bg-light elevation-4 my-2 d-flex justify-content-between"};function we(d,o,m,e,f,t){var i;return r(),a("div",V,[e.activeTower?(r(),a("section",q,[s("div",M,[e.activeTower.isCanceled==!1?(r(),a("img",{key:0,class:"img-fluid rounded mt-2",src:e.activeTower.coverImg,alt:""},null,8,N)):(r(),a("img",{key:1,class:"img-fluid canceled-img rounded mt-2",src:e.activeTower.coverImg,alt:""},null,8,U)),s("div",G,"Created At: "+w(e.formatDate(e.activeTower.createdAt)),1)]),s("div",H,[e.activeTower.isCanceled==!0?(r(),a("h1",W,"Canceled")):y("",!0),s("h2",null,w(e.activeTower.name),1),s("p",null,w(e.activeTower.description),1),e.activeTower.isCanceled==!0?(r(),a("p",z,"Event is Canceled")):(r(),a("h4",J,"Spots Left: "+w(e.ticketsLeft),1)),!e.isAttending&&e.activeTower.isCanceled==!1&&e.activeTower.capacity-e.activeTower.ticketCount!=0?(r(),a("button",{key:3,onClick:o[0]||(o[0]=n=>e.attendTower()),class:"btn btn-warning"},"Attend")):y("",!0),e.activeTower.capacity-e.activeTower.ticketCount===0?(r(),a("button",K,"FULL")):y("",!0),e.isAttending&&e.activeTower.isCanceled==!1?(r(),a("button",{key:5,onClick:o[1]||(o[1]=n=>e.unAttendTower()),class:"btn btn-danger"},"Cancel")):y("",!0),s("div",null,"Event Time: "+w(e.formatDate(e.activeTower.startDate)),1),s("div",null,[O,s("img",{class:"ticket-img",src:e.activeTower.creator.picture,alt:""},null,8,Q),s("span",X,w(e.activeTower.creator.name),1),s("p",Y,"Type of Event: "+w(e.activeTower.type),1)])]),e.account.id==e.activeTower.creatorId&&e.activeTower.isCanceled==!1?(r(),a("button",{key:0,onClick:o[2]||(o[2]=n=>e.archiveTower()),class:"btn btn-danger"}," Cancel Event")):y("",!0)])):y("",!0),Z,s("section",$,[s("div",ee,[(r(!0),a(I,null,b(e.tickets,n=>(r(),a("div",{key:n.id,class:"py-1"},[s("img",{class:"ticket-img",src:n.profile.picture,alt:n.profile.name,title:n.profile.name},null,8,te)]))),128))])]),(i=e.activeTower)!=null&&i.isCanceled?y("",!0):(r(),a("section",oe,[s("div",se,[s("form",{onSubmit:o[4]||(o[4]=B(n=>e.createComment(),["prevent"]))},[ne,E(s("textarea",{required:"","onUpdate:modelValue":o[3]||(o[3]=n=>e.editable.body=n),class:"form-control",name:"comment",id:"comment",rows:"3"},null,512),[[L,e.editable.body]]),ce],32)])])),s("section",ae,[(r(!0),a(I,null,b(e.comments,n=>(r(),a("div",{key:n.id,class:"col-md-10 col-12"},[s("section",re,[s("div",ie,[s("img",{class:"img-fluid ticket-img mt-2",src:n.creator.picture,alt:""},null,8,de),s("h5",le,w(n.creator.name),1)]),s("div",me,[s("p",null,w(n.body),1),e.account.id==n.creatorId?(r(),a("button",{key:0,onClick:o[5]||(o[5]=k=>e.deleteComment()),class:"btn btn-danger"},"Delete")):y("",!0)])])]))),128))])])}const ye=D(R,[["render",we],["__scopeId","data-v-325d1d84"]]);export{ye as default};
